![Workflow](https://github.com/your_salary/your_salary/actions/workflows/your_salary_deploy.yml/badge.svg)

![Python](https://img.shields.io/badge/Python-3.10.9-blue?style=flat&logo=python&logoColor=yellow)
![FastAPI](https://img.shields.io/badge/FastAPI-0.95.2-red?style=flat&logo=fastapi&logoColor=green)
![Postgres](https://img.shields.io/badge/Postgres-15.0-orange?style=flat&logo=postgresql&logoColor=white)

# Your Salary ™
## Бэкенд приложения в рамках выполнения тестового задания

Проект представляет собой REST-сервис, позволяющий сотруднику просмотреть размер текущей заработной платы и даты следующего повышения.
Сотрудник имеет право смотреть только размер собственной заработной платы.
Редактировать даты пересмотра и уровень заработной платы других сотрудников вправе только сотрудники с отдельным допуском.

## Порядок установки проекта

Клонируем репозиторий и переходим в директорию с приложением:
```
git clone https://github.com/your_salary/your_salary.git
```
```
cd ./your_salary/
```

### Структура env-файла:

#### _Первый способ (если необходимо изменить имя БД или ещё что-то)_:
Создаем и открываем для редактирования файл `.env`:
```
sudo nano .env
```
В файл вносим следующие данные:
```
# Включение (True) или выключение (False) режима отладки
DEBUG=True
# указываем имя базы данных
DB_NAME=your_salary_db
# логин для подключения к базе данных
DB_USER=postgres
# пароль для подключения к БД
DB_PASSWORD=postgres
# название сервиса (контейнера) для БД
DB_HOST=your_salary_db
# указываем порт для подключения к БД
DB_PORT=5432
```

#### _Второй способ (если Вас всё устраивает и так)_:
Просто изменяем название файла `envexample`, находящегося в репозитории данного проекта, на `.env`.

### Развертывание с использованием Docker:

Разворачиваем контейнеры в фоновом режиме:
```
sudo docker-compose up -d
```
При первом запуске выполняем следующие команды:
+ применяем миграции:
```
sudo docker-compose exec backend alembic upgrade head
```
+ загружаем тестовые данные в базу:
```
sudo docker-compose exec backend python -m load_data.main
```
#### Логин и пароль от учетной записи тестового пользователя-администратора:
+ _логин_
```
your
```
+ _пароль_
```
salary2023
```

## Эндпоинты приложения

### Работа с пользователями
##### Для доступа к эндпоинтам требуется авторизация

_Получение списка пользователей: доступный метод - GET_
```
/api/v1/employees/
```
_Создание нового пользователя: доступный метод - POST_
```
/api/v1/employees/
```
_Схема запроса:_
```
{
    "first_name": "string",
    "last_name": "string",
    "username": "string",
    "password": "string",
    "password_repeat": "string",
    "date_birth": 2000-01-21,
    "department": 0,
    "position": 0,
    "salary": 0
}
```
+ _отдел (department): поле id_
+ _должность (position): поле id_
+ _заработная плата (salary): поле id_

_Получение информации о пользователе по id: доступный метод - GET_
```
/api/v1/employees/{id}/
```
_Получение информации о текущем пользователе: доступный метод - GET_
```
/api/v1/employees/me/
```
_Редактирование информации о пользователе: доступные методы - PATCH_
```
/api/v1/employees/me/
```
_Доступные поля для изменения:_
```
{
    "first_name": "string",
    "last_name": "string",
    "date_birth": 2000-01-21,
    "department": 0,
    "position": 0,
    "status": "string"
}
```
+ _отдел (department): поле id_
+ _должность (position): поле id_
+ _уровень доступа к данным (status): ***blocked*** - заблокирован, ***active*** - активный, ***admin*** - администратор, ***staff*** - персонал
Изменять поле `status` пользователя имеет право сотрудник со статусом персонала (`staff`) или администратора (`admin`).

_Удаление текущего пользователя: доступный метод - DEL_
```
/api/v1/employees/me/
```
_Удаление пользователя по id: доступный метод - DEL_
```
/api/v1/employees/{id}/
```
_Смена пароля: доступный метод - POST_
```
/api/v1/employees/set_password/
```
_Схема запроса:_
```
{
    "new_password": "string",
    "current_password": "string"
}
```
_Смена логина (username): доступный метод - POST_
```
/api/v1/employees/set_username/
```
_Схема запроса:_
```
{
    "current_password": "string",
    "new_username": "string"
}
```
_Создание токена для пользователя: доступный метод - POST_
```
/api/v1/employees/login/
```
_Схема запроса:_
```
{
    "password": "string",
    "username": "string"
}
```
_Удаление токена: доступный метод - DEL_
```
/api/v1/employees/logout/
```

### Работа с заработной платой
##### Для доступа к эндпоинтам требуется авторизация

_Получение сотрудником его заработной платы и даты следующего повышения: доступный метод - GET_
Сотрудник со статусом персонала (`staff`) или администратора (`admin`) получает список с данными для всех сотрудников.
```
/api/v1/salary/
```
_Создание записи с заработной платой и даты повышения для нового сотрудника: доступный метод - POST_
Доступ к выполнению данной операции имеют только сотрудники со статусом персонала (`staff`) или администратора (`admin`).
```
/api/v1/salary/
```
_Схема запроса:_
```
{
    "amount": 0.00,
    "raise_date": 1990-04-21,
    "employee": 0,
}
```
+ _размер (title) заработной платы_
+ _дата (raise_date) следующего повышения заработной платы_
+ _идентификатор (employee) сотрудника: поле id пользователя_

_Редактирование записи с заработной платой по id: доступный метод - PATCH_
Доступ к выполнению данной операции имеют только сотрудники со статусом персонала (`staff`) или администратора (`admin`).
```
/api/v1/salary/{id}/
```
_Доступные поля для изменения:_
```
{
    "amount": 0.00,
    "raise_date": 1990-04-21,
}
```
+ _размер (title) заработной платы_
+ _дата (raise_date) следующего повышения заработной платы_
_Удаление записи с заработной платой по id: доступный метод - DEL_
Доступ к выполнению данной операции имеют только сотрудники со статусом персонала (`staff`) или администратора (`admin`).
```
/api/v1/salary/{id}/
```
